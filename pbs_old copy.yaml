# mkdir -p /etc/config/; cp -f pbs.yaml /etc/config/pbs

# gdpr:
#   enabled: false
#   default_value: 0
#   host_vendor_id: 76
#   timeouts_ms:
#     init_vendorlist_fetches: 100000
#     active_vendorlist_fetch: 1
# cache:
#   host: http://mockserver:1080
# adapters:
#   pubmatic:
#     endpoint: http://localhost:1080/mockserver/adserver?adapter=pubmatic
#   appnexus:
#    endpoint: http://mockserver:1080/mockserver/adserver?adapter=appnexus
#   rubicon:
#     disabled: false
#     endpoint: http://mockserver:1080/mockserver/adserver?adapter=rubicon
#   huaweiads:
#     disabled: false
# account_defaults:
#   alternatebiddercodes:
#     enabled: true
#     bidders:
#       pubmatic:
#         enabled: true
#         allowedbiddercodes: [pubmatic-dummy, groupm]
#       appnexus:
#         allowedbiddercodes: [xyz]
#       empty-bidder-codes:
#         allowedbiddercodes: []
#       undefined-bidder-codes:
#         enabled: true
analytics:
  file:
    filename: /tmp/nyc_pbs.log
stored_requests:
  filesystem:
    enabled: true
    directorypath: /Users/Nilesh/go/src/devsetup-nyc/pbs-sp
hooks:
  enabled: true
  modules:
    pubmatic:
      openwrap:
        enabled: true
        OpenWrap:
          Server:
            ServerPort: "8001"
            DCName: "SV3"
          Database:
            DBHost: 10.172.96.13
            DBPort: 3306
            DBUser: "kdbuser"
            DBPass: "KdBuSeR12!"
            Database: "giym"
            DBIdleConnection: 50
            DBMaxConnection: 400
            DBConnMaxLifetime: 18000
          Logger:
            Enabled: false
            Endpoint: "http://10.110.194.12:8842/wl"
            PublicEndpoint: "http://10.110.194.12:8842/wl"
            MaxClients: 500
            MaxConnections: 1024
            MaxCalls: 100
            RespTimeout: 150
          Cache:
            CacheDefaultExpiry: 3600 # in second
            VASTTagCacheExpiry: 1800 # in second
            CacheConTimeout: 20000
          Timeout:
            MaxTimeout: 50000
            MinTimeout: 20000
            PrebidDelta: 1000
            HBTimeout: 2500
            MaxQueryTimeout: 500000
            MaxDbContextTimeout: 200000
          Tracker:
            Endpoint: "//10.110.194.12:8842/wt"
            VideoErrorTrackerEndpoint: "//10.110.194.12:8842/wt"
          Pixelview:
            OMScript: "https://ads.pubmatic.com/AdServer/js/owpubomverification.js"
  host_execution_plan:
    endpoints:
      /openrtb2/auction:
        stages:
          entrypoint:
            groups:
              - timeout: 500000
                hook_sequence:
                  - module_code: pubmatic.openwrap
                    hook_impl_code: pubmatic.openwrap.fetch_profile_meta

# Below is Prebid Server Configuration
external_url: "http://ow.pubmatic.com"
tracker_url: "https://10.110.194.12:8842/wt?operId=8&e=[EVENT_ID]&p=[PBS-ACCOUNT]&pid=[PROFILE_ID]&v=[PROFILE_VERSION]&ts=[UNIX_TIMESTAMP]&pn=[PBS-BIDDER]&adv=[ADVERTISER_NAME]&sURL=[DOMAIN]&pfi=[PLATFORM]&af=[ADTYPE]&iid=[WRAPPER_IMPRESSION_ID]&pseq=[PODSEQUENCE]&adcnt=[ADCOUNT]&cb=[CACHEBUSTING]&au=[AD_UNIT]&bidid=[PBS-BIDID]&origbidid=[PBS-ORIG_BIDID]&bc=[BIDDER_CODE]"
adapters:
  appnexus:
    endpoint: "http://10.110.194.12:3141/openrtb2"
  pubmatic:
    # endpoint: "http://10.172.141.15:9009/translator?source=pubmatic-server"
    # endpoint: http://mockserver:1080/mockserver/adserver?adapter=pubmatic-hb-json-1-marketplace
    endpoint: http://localhost:1080/mockserver/adserver?adapter=pubmatic
  ix:
    endpoint: "http://pubmatic-us-west.lb.indexww.com/transbidder?p=186523"
    usersync:
      redirect:
        url: "https://ssum.casalemedia.com/usermatchredir?s=186523&gdpr={{.GDPR}}&gdpr_consent={{.GDPRConsent}}&us_privacy={{.USPrivacy}}&cb={{.RedirectURL}}"
  dmx:
    endpoint: "https://dmx-direct.districtm.io/b/v2"
    usersync:
      redirect:
        url: "https://dmx.districtm.io/s/v1/img/s/10007?gdpr={{.GDPR}}&gdpr_consent={{.GDPRConsent}}&redirect={{.RedirectURL}}"
        redirect_url: "http://ow.pubmatic.com/setuid?bidder=datablocks&gdpr=${gdpr}&gdpr_consent=${gdpr_consent}&uid=${uid}"
  rubicon:
    endpoint: "http://exapi-us-west.rubiconproject.com/a/api/exchange.json?tk_sdc=us-west"
    usersync:
      default: redirect
      redirect: 
        url: "https://pixel.rubiconproject.com/exchange/sync.php?p=pbs-pubmatic"
    XAPI:
      Username: "prebid_server_pubmatic"
      Password: "3HV6AVT2WS"
      tracker": "pbs-pub"
  smartadserver:
    endpoint: "https://ssb-us.smartadserver.com"
  unruly:
    usersync:
      default: iframe
      iframe:
        url: "https://sync.1rx.io/usersync2/rmpssp?sub=openwrap&gdpr={{.GDPR}}&consent={{.GDPRConsent}}&us_privacy={{.USPrivacy}}&rurl={{.RedirectURL}}%24UID"
        userMacro: "[RX_UUID]"
  pangle:
    endpoint: "https://api16-access-sg.pangle.io/api/ad/union/openrtb/get_ads/staging/"
  grid:
    endpoint: "http://grid-usw.bidswitch.net/sp_bid?sp=prebid"
  outbrain:
    endpoint: "http://b1h.zemanta.com/api/bidder/prebid/bid/"
    usersync_url : "https://b1h.zemanta.com/usersync/prebid?gdpr={{.GDPR}}&gdpr_consent={{.GDPRConsent}}&us_privacy={{.USPrivacy}}&cb={{.RedirectURL}}"
  stroeercore:
    disabled : false
  spotx:
    endpoint: "https://search.spotxchange.com/openrtb/2.3/dados"
  vastbidder:
    endpoint: "https://test.com"

cache:
  host: "10.110.210.88/creativecache"
  scheme: "http"
  query: "uuid"

host_cookie:
  domain: "dev-sv3.pubmatic.com"

# If we change the base image to a non-linux based one, we would also need to update the path for "certificates_file" in the property below
certificates_file: "/etc/ssl/cert.pem"

metrics:
  prometheus:
    Enabled: true
    UseSeparateServerInstance: false
    ExposePrebidMetrics: true
    port: 8002    #Set value 0 when value of ExposePrebidMetrics = false and set non-zero value(e.g 8002) when value of ExposePrebidMetrics = true OR UseSeparateServerInstance = true
    namespace: "ow"
    subsystem: "pbs"
    timeout_ms: 300
    HBNamespace: "ow"
    HBSubsystem: "hb"
  disabled_metrics:
    adapter_connections_metrics: false

http_client:    
  max_connections_per_host: 512
  max_idle_connections: 0
  max_idle_connections_per_host: 100
  idle_connection_timeout_seconds: 600
  tls_handshake_timeout: 1000
  response_header_timeout: 500
  dial_timeout: 10000
  dial_keepalive: 3000

gdpr:
  default_value: "0"
  timeouts_ms:
    init_vendorlist_fetches: 60000

vendor_list_scheduler:
  enabled: true
  interval: "4h"
  timeout: "1m"

price_floors:
    enabled: true

account_defaults:
  price_floors:
    enabled: true
    enforce_deal_floors: true
    enforce_floors_rate: 100
    adjust_for_bid_adjustment: false
    use_dynamic_data: false
    fetch:
      enabled: false
      timeout_ms: 1000
      max_file_size_kb: 100
      max_rules: 1000
      max_age_sec: 86400
      period_sec: 3600

generate_bid_id: true    # To generate unique bidID in seated[].bid[].ext.prebid.bidid
features:
  inlineHBEnabled: true
